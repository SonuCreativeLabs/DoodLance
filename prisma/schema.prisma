generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                     String             @id @default(cuid())
  displayId              String?            @unique
  username               String?            @unique
  email                  String             @unique
  name                   String?
  avatar                 String?
  role                   String             @default("client")
  supabaseUid            String?            @unique
  phone                  String?
  phoneVerified          Boolean            @default(false)
  phoneVerifiedAt        DateTime?
  location               String?
  coords                 String
  bio                    String?
  gender                 String?
  address                String?
  city                   String?
  state                  String?
  postalCode             String?
  currentRole            String             @default("client")
  status                 String             @default("active")
  isVerified             Boolean            @default(false)
  referralCode           String?            @unique
  referredBy             String?
  createdAt              DateTime           @default(now())
  updatedAt              DateTime           @updatedAt
  freelancerApplications Application[]      @relation("FreelancerApplications")
  bookings               Booking[]          @relation("UserBookings")
  clientProfile          ClientProfile?
  freelancerProfile      FreelancerProfile?
  clientJobs             Job[]              @relation("ClientJobs")
  freelancerJobs         Job[]              @relation("FreelancerJobs")
  sentMessages           Message[]          @relation("MessageSender")
  notifications          Notification[]
  promoUsages            PromoUsage[]
  services               Service[]          @relation("UserServices")
  supportTickets         SupportTicket[]
  wallet                 Wallet?

  @@map("users")
}

model Category {
  id            String     @id @default(cuid())
  name          String     @unique
  slug          String     @unique
  description   String?
  icon          String?
  parentId      String?
  isActive      Boolean    @default(true)
  sortOrder     Int        @default(0)
  parent        Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  subcategories Category[] @relation("CategoryHierarchy")
  services      Service[]

  @@map("categories")
}

model Service {
  id           String    @id @default(cuid())
  title        String
  description  String
  price        Float
  duration     Int
  categoryId   String
  providerId   String
  images       String
  tags         String
  location     String?
  coords       String
  serviceType  String
  deliveryTime String?
  revisions    Int       @default(0)
  packages     String?
  requirements String
  isActive     Boolean   @default(true)
  rating       Float     @default(0)
  reviewCount  Int       @default(0)
  totalOrders  Int       @default(0)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  bookings     Booking[]
  category     Category  @relation(fields: [categoryId], references: [id])
  provider     User      @relation("UserServices", fields: [providerId], references: [id])

  @@map("services")
}

model Booking {
  id             String    @id @default(cuid())
  clientId       String
  serviceId      String
  scheduledAt    DateTime?
  duration       Int
  totalPrice     Float
  packageType    String?
  status         String    @default("PENDING")
  location       String?
  coords         String
  progress       Int       @default(0)
  milestones     String?
  conversationId String?
  notes          String?
  requirements   String?
  deliveredAt    DateTime?
  deliverables   String
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  client         User      @relation("UserBookings", fields: [clientId], references: [id])
  service        Service   @relation(fields: [serviceId], references: [id])

  @@map("bookings")
}

model Wallet {
  id           String        @id @default(cuid())
  userId       String        @unique
  balance      Float         @default(0)
  coins        Int           @default(0)
  frozenAmount Float         @default(0)
  isActive     Boolean       @default(true)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  transactions Transaction[]
  user         User          @relation(fields: [userId], references: [id])

  @@map("wallets")
}

model Transaction {
  id            String   @id @default(cuid())
  walletId      String
  amount        Float
  type          String
  description   String
  reference     String?
  status        String   @default("COMPLETED")
  paymentMethod String?
  paymentId     String?
  createdAt     DateTime @default(now())
  wallet        Wallet   @relation(fields: [walletId], references: [id])

  @@map("transactions")
}

model Job {
  id           String        @id @default(cuid())
  title        String
  description  String
  category     String
  budget       Float
  budgetMin    Float?
  budgetMax    Float?
  location     String
  coords       String
  skills       String
  workMode     String
  type         String
  duration     String?
  experience   String
  scheduledAt  DateTime?
  clientId     String
  freelancerId String?
  status       String        @default("OPEN")
  progress     Int           @default(0)
  peopleNeeded Int           @default(1)
  notes        String?
  completedAt  DateTime?
  completedBy  String?
  isActive     Boolean       @default(true)
  proposals    Int           @default(0)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  applications Application[]
  client       User          @relation("ClientJobs", fields: [clientId], references: [id])
  freelancer   User?         @relation("FreelancerJobs", fields: [freelancerId], references: [id])

  @@map("jobs")
}

model Application {
  id            String   @id @default(cuid())
  jobId         String
  freelancerId  String
  coverLetter   String
  proposedRate  Float
  estimatedDays Int
  skills        String
  attachments   String
  status        String   @default("PENDING")
  progress      Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  freelancer    User     @relation("FreelancerApplications", fields: [freelancerId], references: [id])
  job           Job      @relation(fields: [jobId], references: [id])

  @@map("applications")
}

model Conversation {
  id                    String    @id @default(cuid())
  clientId              String
  freelancerId          String
  jobId                 String?
  bookingId             String?
  lastMessage           String?
  lastMessageAt         DateTime?
  lastMessageType       String    @default("TEXT")
  clientUnreadCount     Int       @default(0)
  freelancerUnreadCount Int       @default(0)
  isActive              Boolean   @default(true)
  isArchived            Boolean   @default(false)
  lastCallAt            DateTime?
  totalCallDuration     Int       @default(0)
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  messages              Message[]

  @@map("conversations")
}

model Message {
  id             String       @id @default(cuid())
  conversationId String
  senderId       String
  content        String
  messageType    String       @default("TEXT")
  attachments    String
  isRead         Boolean      @default(false)
  readAt         DateTime?
  isDelivered    Boolean      @default(false)
  deliveredAt    DateTime?
  isEdited       Boolean      @default(false)
  editedAt       DateTime?
  replyToId      String?
  createdAt      DateTime     @default(now())
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  sender         User         @relation("MessageSender", fields: [senderId], references: [id])

  @@map("messages")
}

model FreelancerProfile {
  id                   String       @id @default(cuid())
  userId               String       @unique
  title                String?
  about                String?
  hourlyRate           Float?
  skills               String
  specializations      String
  cricketRole          String?
  battingStyle         String?
  bowlingStyle         String?
  dateOfBirth          DateTime?
  rating               Float        @default(0)
  reviewCount          Int          @default(0)
  completedJobs        Int          @default(0)
  responseTime         String?
  deliveryTime         String?
  completionRate       Float        @default(0)
  repeatClientRate     Float        @default(0)
  coords               String
  serviceRadius        Float?
  advanceNoticeHours   Int?
  isOnline             Boolean      @default(false)
  availability         String?
  listings             String?
  timeZone             String       @default("Asia/Kolkata")
  isVerified           Boolean      @default(false)
  verificationDocs     String?
  verifiedAt           DateTime?
  totalEarnings        Float        @default(0)
  thisMonthEarnings    Float        @default(0)
  avgProjectValue      Float        @default(0)
  isProfilePublic      Boolean      @default(true)
  acceptsMessages      Boolean      @default(true)
  notificationSettings String?
  coverImage           String?
  createdAt            DateTime     @default(now())
  updatedAt            DateTime     @updatedAt
  experiences          Experience[]
  user                 User         @relation(fields: [userId], references: [id])
  portfolios           Portfolio[]
  reviews              Review[]

  @@map("freelancer_profiles")
}

model Experience {
  id          String            @id @default(cuid())
  profileId   String
  role        String
  company     String
  location    String
  startDate   String
  endDate     String?
  isCurrent   Boolean           @default(false)
  description String
  createdAt   DateTime          @default(now())
  profile     FreelancerProfile @relation(fields: [profileId], references: [id])

  @@map("experiences")
}

model Portfolio {
  id          String            @id @default(cuid())
  profileId   String
  title       String
  category    String
  description String?
  images      String
  skills      String
  clientName  String?
  completedAt DateTime?
  createdAt   DateTime          @default(now())
  profile     FreelancerProfile @relation(fields: [profileId], references: [id])

  @@map("portfolios")
}

model Review {
  id                  String            @id @default(cuid())
  profileId           String
  clientId            String
  clientName          String
  clientRole          String?
  clientAvatar        String?
  rating              Int
  comment             String
  isVerified          Boolean           @default(false)
  communicationRating Int?
  qualityRating       Int?
  timelinessRating    Int?
  bookingId           String?
  jobId               String?
  response            String?
  respondedAt         DateTime?
  createdAt           DateTime          @default(now())
  profile             FreelancerProfile @relation(fields: [profileId], references: [id])

  @@map("reviews")
}

model ClientProfile {
  id               String    @id @default(cuid())
  userId           String    @unique
  company          String?
  website          String?
  industry         String?
  totalSpent       Float     @default(0)
  projectsPosted   Int       @default(0)
  hireRate         Float     @default(0)
  avgRating        Float     @default(0)
  preferredBudget  String?
  preferredSkills  String
  isVerified       Boolean   @default(false)
  verificationDocs String?
  verifiedAt       DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  user             User      @relation(fields: [userId], references: [id])

  @@map("client_profiles")
}

model Notification {
  id         String    @id @default(cuid())
  userId     String
  title      String
  message    String
  type       String
  entityId   String?
  entityType String?
  actionUrl  String?
  actionData String?
  isRead     Boolean   @default(false)
  readAt     DateTime?
  createdAt  DateTime  @default(now())
  user       User      @relation(fields: [userId], references: [id])

  @@map("notifications")
}

model SystemConfig {
  id          String   @id @default(cuid())
  key         String   @unique
  value       String
  type        String   @default("STRING")
  category    String   @default("GENERAL")
  description String?
  updatedAt   DateTime @updatedAt

  @@map("system_config")
}

model FeaturedItem {
  id         String   @id @default(cuid())
  type       String
  itemId     String
  title      String
  position   Int
  imageUrl   String?
  validFrom  DateTime
  validUntil DateTime
  isActive   Boolean  @default(true)
  clickCount Int      @default(0)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("featured_items")
}

model PlatformAnalytics {
  id                String   @id @default(cuid())
  date              DateTime @unique
  totalUsers        Int      @default(0)
  newUsers          Int      @default(0)
  activeUsers       Int      @default(0)
  totalBookings     Int      @default(0)
  completedBookings Int      @default(0)
  cancelledBookings Int      @default(0)
  totalRevenue      Float    @default(0)
  platformFees      Float    @default(0)
  avgBookingValue   Float    @default(0)
  totalServices     Int      @default(0)
  activeServices    Int      @default(0)
  categoryMetrics   String?
  createdAt         DateTime @default(now())

  @@map("platform_analytics")
}

model Admin {
  id            String    @id @default(cuid())
  email         String    @unique
  password_hash String
  name          String
  role          String    @default("admin")
  permissions   String?
  avatar        String?
  last_login_at DateTime?
  is_active     Boolean   @default(true)
  created_at    DateTime  @default(now())
  updated_at    DateTime  @updatedAt

  @@map("admins")
}

model AdminLog {
  id         String   @id @default(cuid())
  adminId    String
  adminEmail String
  action     String
  resource   String
  resourceId String?
  details    String?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())

  @@index([adminId])
  @@index([resource])
  @@index([createdAt])
  @@map("admin_logs")
}

model PromoCode {
  id             String       @id @default(cuid())
  code           String       @unique
  description    String?
  discountType   String
  discountValue  Float
  minOrderAmount Float?
  maxDiscount    Float?
  startDate      DateTime     @default(now())
  endDate        DateTime?
  usageLimit     Int?
  perUserLimit   Int?
  usedCount      Int          @default(0)
  status         String       @default("active")
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  usages         PromoUsage[]

  @@map("promo_codes")
}

model PromoUsage {
  id             String    @id @default(cuid())
  promoCodeId    String
  userId         String
  orderId        String
  orderAmount    Float
  discountAmount Float
  createdAt      DateTime  @default(now())
  promoCode      PromoCode @relation(fields: [promoCodeId], references: [id], onDelete: Cascade)
  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([promoCodeId])
  @@index([userId])
  @@map("promo_usages")
}

model SupportTicket {
  id           String          @id @default(cuid())
  userId       String
  ticketNumber String          @unique @default(cuid())
  category     String
  subject      String
  description  String
  status       String          @default("OPEN")
  priority     String          @default("MEDIUM")
  assignedTo   String?
  bookingId    String?
  jobId        String?
  resolution   String?
  attachments  String?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  resolvedAt   DateTime?
  user         User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages     TicketMessage[]

  @@index([userId])
  @@index([status])
  @@map("support_tickets")
}

model TicketMessage {
  id           String        @id @default(cuid())
  ticketId     String
  senderId     String
  message      String
  isAdminReply Boolean       @default(false)
  createdAt    DateTime      @default(now())
  ticket       SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([ticketId])
  @@map("ticket_messages")
}
